@using FaceLook.Services.Extensions;
@model IList<ShareFileItemViewModel>
@section Styles {
	<link rel="stylesheet" href="~/css/pictures.css" />
}
@{
	var pictureControllerName = ControllersExtensions.GetControllerName<PicturesController>();
}

@if (Model.Count == 0)
{
	<span>No files to show</span>
}
else
{
	<div class="container">
		<span class="text-success">@TempData[PictureConstants.PictureMessageKey]</span>
	</div>
	<a href="@this.Url.Action(action: nameof(PicturesController.Upload), controller: pictureControllerName)">Upload picture</a>
	<div class="d-flex gap-4">
		@foreach (var pictureUri in Model)
		{
			<div class="user-picture-container" data-full="@pictureUri.SasUrl">
				<img src="@pictureUri.SasUrl"
					 alt="User picture"
					 class="user-picture" />
				<span class="edit-icon"
					  title="Edit"
					  data-edit="@pictureUri.Name"
					  tabindex="0">
					<i class="bi bi-pencil"></i>
				</span>
				<ul class="picture-actions-list" style="display:none; position:absolute; top:32px; right:8px; z-index:10; background:white; border:1px solid #ccc; border-radius:4px; list-style:none; padding:0; margin:0; min-width:120px;">
					<li>
						<form method="post" asp-controller="Pictures" asp-action="@nameof(PicturesController.Delete)" asp-route-pictureName="@pictureUri.Name" style="margin:0;">
							<button type="submit" class="dropdown-item text-danger" style="width:100%;text-align:left;">Delete picture</button>
						</form>
					</li>
				</ul>
			</div>
		}
	</div>
}

<partial name="_GenericModalPartial" model="string.Empty" />

@section Scripts {
	<script>
				document.addEventListener('DOMContentLoaded', function () {
			const pictureContainers = document.querySelectorAll('.user-picture-container');
			const editIcons = document.querySelectorAll('.edit-icon');
			const modalImageContainer = document.getElementById('modalContainer');
			const modal = new bootstrap.Modal(document.getElementById('genericModal'));

			pictureContainers.forEach(container => {
				container.querySelector('.user-picture').addEventListener('click', function (e) {
					e.stopPropagation();
					const imgUrl = container.getAttribute('data-full');
					if (modalImageContainer) {
						modalImageContainer.innerHTML =
							`<img src="${imgUrl}" class="large-picture" alt="Large picture" />`;
					}
					modal.show();
				});
			});

			editIcons.forEach(editIconSpan => {
				editIconSpan.addEventListener('click', function (e) {
					e.stopPropagation();
					e.preventDefault();
					document.querySelectorAll('.picture-actions-list').forEach(list => list.style.display = 'none');
					const actionsList = this.parentElement.querySelector('.picture-actions-list');
					if (actionsList) {
						actionsList.style.display = 'block';
					}
				});
			});

			document.addEventListener('click', function (e) {
				if (!e.target.closest('.user-picture-container')) {
					document.querySelectorAll('.picture-actions-list').forEach(list => list.style.display = 'none');
				}
			});
		});
	</script>
}